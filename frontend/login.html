<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Connexion – TicketApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      height: 100vh;
      display: flex;
      align-items: center;
    }
    .login-card {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .logged-in-view {
      display: none;
      text-align: center;
    }
    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #6c5ce7;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin: 0 auto 20px;
    }
  </style>
</head>
<body>
  <div class="container d-flex justify-content-center align-items-center">
    <div class="card login-card shadow p-4">
      <!-- Vue Connexion (par défaut) -->
      <div id="loginView">
        <h2 class="text-center mb-4"><i class="fas fa-lock"></i> Connexion</h2>
        
        <div id="error" class="alert alert-danger d-none" role="alert"></div>
        
        <form id="loginForm">
          <div class="mb-3">
            <label for="email" class="form-label">Email d'utilisateur</label>
            <input type="email" class="form-control" id="email" placeholder="Email ici" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Mot de passe</label>
            <input type="password" class="form-control" id="password" placeholder="Mot de passe" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-sign-in-alt"></i> Se connecter
          </button>
        </form>
      </div>
      
      <!-- Vue Déjà connecté -->
      <div id="loggedInView" class="logged-in-view">
        <div class="user-avatar" id="userAvatar"></div>
        <h3 id="welcomeMessage">Bonjour, Utilisateur</h3>
        <p class="text-muted mb-4">Vous êtes déjà connecté</p>
        <button id="logoutBtn" class="btn btn-danger w-100">
          <i class="fas fa-sign-out-alt"></i> Se déconnecter
        </button>
        <a href="dashboard.html" class="btn btn-outline-primary w-100 mt-2">
          <i class="fas fa-tachometer-alt"></i> Aller au tableau de bord
        </a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const loginView = document.getElementById('loginView');
      const loggedInView = document.getElementById('loggedInView');
      const loginForm = document.getElementById('loginForm');
      const errorDiv = document.getElementById('error');
      const logoutBtn = document.getElementById('logoutBtn');
      const welcomeMessage = document.getElementById('welcomeMessage');
      const userAvatar = document.getElementById('userAvatar');
      
      // Vérifier si l'utilisateur est déjà connecté
      checkAuthStatus();
      
      // Gestion de la soumission du formulaire
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        // Simulation d'une requête API
        simulateLogin(email, password)
          .then(data => {
            if (data.success) {
              // Stocker les informations de l'utilisateur
              localStorage.setItem('ticketAppAuth', JSON.stringify({
                id: data.user.id,
                name: data.user.name,
                email: data.user.email,
                role: data.user.role
              }));
              
              // Afficher la vue connectée
              checkAuthStatus();
            } else {
              showError(data.message || "Email ou mot de passe incorrect");
            }
          })
          .catch(error => {
            showError("Erreur de connexion au serveur");
            console.error("Erreur:", error);
          });
      });
      
      // Gestion de la déconnexion
      logoutBtn.addEventListener('click', function() {
        localStorage.removeItem('ticketAppAuth');
        checkAuthStatus();
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
      });
      
      // Fonction pour vérifier l'état d'authentification
      function checkAuthStatus() {
        const userData = localStorage.getItem('ticketAppAuth');
        
        if (userData) {
          const user = JSON.parse(userData);
          
          // Afficher la vue connectée
          loginView.style.display = 'none';
          loggedInView.style.display = 'block';
          
          // Mettre à jour les infos utilisateur
          welcomeMessage.textContent = `Bonjour, ${user.name}`;
          userAvatar.textContent = user.name.charAt(0).toUpperCase();
          userAvatar.style.backgroundColor = getRandomColor();
        } else {
          // Afficher la vue de connexion
          loginView.style.display = 'block';
          loggedInView.style.display = 'none';
        }
      }
      
      // Fonction pour simuler une connexion API
      function simulateLogin(email, password) {
        return new Promise((resolve, reject) => {
          // Simuler un délai réseau
          setTimeout(() => {
            // Données mock pour la démo
            const mockUsers = [
              { id: 1, email: 'admin@example.com', password: 'admin123', name: 'Admin User', role: 'admin' },
              { id: 2, email: 'agent@example.com', password: 'agent123', name: 'Agent Support', role: 'agent' },
              { id: 3, email: 'user@example.com', password: 'user123', name: 'Regular User', role: 'user' }
            ];
            
            const user = mockUsers.find(u => u.email === email && u.password === password);
            
            if (user) {
              resolve({
                success: true,
                user: {
                  id: user.id,
                  name: user.name,
                  email: user.email,
                  role: user.role
                }
              });
            } else {
              resolve({
                success: false,
                message: "Identifiants incorrects"
              });
            }
          }, 800);
        });
      }
      
      // Fonction pour afficher les erreurs
      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.classList.remove('d-none');
        
        // Masquer l'erreur après 5 secondes
        setTimeout(() => {
          errorDiv.classList.add('d-none');
        }, 5000);
      }
      
      // Fonction utilitaire pour générer une couleur aléatoire
      function getRandomColor() {
        const colors = [
          '#6c5ce7', '#00b894', '#0984e3', '#d63031', 
          '#fdcb6e', '#e17055', '#e84393', '#00cec9'
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }
    });
  </script>
</body>
</html>